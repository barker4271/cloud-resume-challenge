<%--
  blog.ejs

  Purpose:
  - Display blog posts fetched from Azure Cosmos DB
  - Provide a button to create a new post

  Data provided by server.js:
    title   : string
    posts   : array (may be empty)
    message : optional string

  IMPORTANT:
  - DO NOT include layout manually
  - express-ejs-layouts injects this into <%- body %>
--%>

<section style="
  max-width: 900px;
  margin: 0 auto;
  padding: 40px 20px;
">

  <h1 style="text-align: center; margin-bottom: 10px;">
    Blog
  </h1>

  <p style="text-align: center; color: #aaa; margin-bottom: 30px;">
    Notes from the journey.
  </p>

  <div style="text-align: center; margin-bottom: 40px;">
    <a href="/blog/new"
       style="
         padding: 10px 20px;
         background: #1976d2;
         color: white;
         text-decoration: none;
         border-radius: 6px;
       ">
      + New Blog Post
    </a>
  </div>

  <% if (message) { %>
    <div style="
      background: #332;
      color: #ffeb3b;
      padding: 15px;
      border-radius: 6px;
      margin-bottom: 30px;
      text-align: center;
    ">
      <%= message %>
    </div>
  <% } %>

  <% if (!posts || posts.length === 0) { %>

    <p style="text-align: center; color: #888;">
      No blog posts yet.
    </p>

  <% } else { %>

    <% posts.forEach(function(post) { %>

      <article style="
        background: #1e1e1e;
        padding: 25px;
        border-radius: 8px;
        margin-bottom: 25px;
      ">

        <h2 style="margin-top: 0; color: #ffee58;">
          <%= post.topic %>
        </h2>

        <p style="font-size: 0.9rem; color: #aaa;">
          Posted on <%= new Date(post.createdAt).toLocaleString() %>
        </p>

        <div style="
          margin-top: 15px;
          line-height: 1.6;
          white-space: pre-wrap;
        ">
          <%= post.body %>
        </div>

      </article>

    <% }); %>

  <% } %>

</section>
